# S4_run_BBGDM

This folder is part of the workflow for analyzing taxonomic and functional beta diversity. It focuses on implementing Bayesian Bootstrapped Generalized Dissimilarity Models (BBGDM) to explore ecological replacement patterns.

## Folder Structure

``` plaintext
S4_run_BBGDM
├── bbgdm_output
│   └── [*.rds]                # Output files from BBGDM analysis for each dataset.
├── functions
│   └── helper_functions_S4.R  # Contains auxiliary functions for running BBGDM and processing results.
├── scripts
│   ├── main_script_S4.R       # Main script for running BBGDM analysis.
│   ├── plot_figure_1.R        # Script for generating Figure 1.
│   └── run_final_bbgdm.sh     # Shell script for submitting batch jobs to HPC.
```

## Overview

### Objective

This module applies Bayesian Bootstrapped Generalized Dissimilarity Models (BBGDM) to:

-   Analyze beta diversity replacement patterns (species and traits).
-   Quantify the effects of predictors on homogenization and differentiation.
-   Visualize replacement patterns across systems, taxa, and environmental predictors.

### Key Scripts

1.  **`main_script_S4.R`**
    -   Main script for executing BBGDM on preprocessed datasets.\
    -   Loads beta diversity and predictor data and saves model outputs in `.rds` format.
2.  **`plot_figure_1.R`**
    -   Script for generating Figure 1:
        -   Panel A: Standardized effect sizes of predictors.\
        -   Panel B: Circular visualization of replacement patterns.\
    -   Outputs figures in PDF format, ready for publication.
3.  **`run_final_bbgdm.sh`**
    -   Shell script to run BBGDM analysis on a high-performance computing (HPC) cluster.\
    -   Leverages SLURM for batch processing.

### Outputs

-   **BBGDM Results**:\
    Saved in the `bbgdm_output/` folder as `.rds` files, containing model summaries for each dataset.

-   **Figures**:\
    Generated by `plot_figure_1.R` and saved as high-quality PDF files.

## Input Data

-   **Beta Diversity Metrics**:\
    Located in `S2_get_beta_diversity/betadiv_output/` (e.g., `*_beta_Output.rds` files).

-   **Predictor Variables**:\
    Located in `S3_get_best_predictors/best_predictors/coeff/` (e.g., `*_pred.rds` files).

## Notes

-   **Execution on HPC**:\
    Use `run_final_bbgdm.sh` to execute BBGDM on multiple datasets in parallel. Modify the script to suit your specific job scheduler (e.g., Slurm).

-   **Local Execution**:\
    For testing locally, use `main_script_S4.R`. Set `ii <- 1` in the script to process a single dataset.

-   **Dependencies**:\
    Ensure the following R packages are installed:

    -   `tidyverse`, `gdm`, `surveillance`, `magrittr`, `plotrix`, `glue`, `cowplot`, `ggplot2`, `ggtext`, `ggbrace`, `ggnewscale`, `colorspace`, `showtext`, and `ggh4x`.

------------------------------------------------------------------------
